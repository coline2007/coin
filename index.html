from flask import Flask, jsonify
import requests

app = Flask(__name__)

@app.route('/recommend-stock')
def recommend_stock():
    url = "https://data.krx.co.kr/comm/bldAttendant/getJsonData.cmd"
    payload = {
        "bld": "dbms/MDC/STAT/standard/MDCSTAT01901",  # KRX ìƒìŠ¹ë¥  ìˆœìœ„
        "mktId": "ALL",  # ì „ì²´ ì‹œì¥ (KOSPI + KOSDAQ)
        "trdDd": "20250405"  # ë‚ ì§œ (ì˜¤ëŠ˜ ë‚ ì§œë¡œ ìë™ ì²˜ë¦¬ í•„ìš”)
    }
    headers = {
        "Content-Type": "application/x-www-form-urlencoded"
    }

    res = requests.post(url, data=payload, headers=headers)
    data = res.json()["OutBlock_1"][:5]  # ìƒìœ„ 5ì¢…ëª© ì¶”ì¶œ

    stocks = []
    for stock in data:
        name = stock["ISU_ABBRV"]
        rate = stock["FLUC_RT"]
        price = stock["TDD_CLSPRC"]
        comment = f"{name} â€“ í˜„ì¬ê°€ {price}ì›, ìƒìŠ¹ë¥  {rate}% ğŸ“ˆ"
        stocks.append(comment)

    return jsonify(stocks)
async function showStockRecommendation() {
    const messageList = [
        "ê¸°ë‹¤ë ¤ ë³´ì„¸ìš”.",
        "ì¢‹ì€ ìƒê°ì´ì—ìš”!",
        "ë§ˆë²•ì˜ NFCê°€ ì˜ˆê°í•œ ì¢…ëª©ì…ë‹ˆë‹¤ ğŸ”®"
    ];

    const message = messageList[Math.floor(Math.random() * messageList.length)];
    document.getElementById("message").innerText = message;

    try {
        const response = await fetch("http://localhost:5000/recommend-stock");  // ë°±ì—”ë“œ ì£¼ì†Œ
        const data = await response.json();
        const stock = data[Math.floor(Math.random() * data.length)];
        document.getElementById("stock").innerText = stock;
    } catch (error) {
        document.getElementById("stock").innerText = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
    }
