from flask import Flask, jsonify
import requests

app = Flask(__name__)

@app.route('/recommend-stock')
def recommend_stock():
    url = "https://data.krx.co.kr/comm/bldAttendant/getJsonData.cmd"
    payload = {
        "bld": "dbms/MDC/STAT/standard/MDCSTAT01901",  # KRX 상승률 순위
        "mktId": "ALL",  # 전체 시장 (KOSPI + KOSDAQ)
        "trdDd": "20250405"  # 날짜 (오늘 날짜로 자동 처리 필요)
    }
    headers = {
        "Content-Type": "application/x-www-form-urlencoded"
    }

    res = requests.post(url, data=payload, headers=headers)
    data = res.json()["OutBlock_1"][:5]  # 상위 5종목 추출

    stocks = []
    for stock in data:
        name = stock["ISU_ABBRV"]
        rate = stock["FLUC_RT"]
        price = stock["TDD_CLSPRC"]
        comment = f"{name} – 현재가 {price}원, 상승률 {rate}% 📈"
        stocks.append(comment)

    return jsonify(stocks)
async function showStockRecommendation() {
    const messageList = [
        "기다려 보세요.",
        "좋은 생각이에요!",
        "마법의 NFC가 예감한 종목입니다 🔮"
    ];

    const message = messageList[Math.floor(Math.random() * messageList.length)];
    document.getElementById("message").innerText = message;

    try {
        const response = await fetch("http://localhost:5000/recommend-stock");  // 백엔드 주소
        const data = await response.json();
        const stock = data[Math.floor(Math.random() * data.length)];
        document.getElementById("stock").innerText = stock;
    } catch (error) {
        document.getElementById("stock").innerText = "데이터를 불러오는 데 실패했습니다.";
    }
